(()=>{function e(e){if(e=o.i?.[e]||e,!t)try{throw Error()}catch(a){var s=(""+a.stack).match(/(https?|file|ftp|(chrome|moz|safari-web)-extension):\/\/[^)\n]+/g);if(!s)return n+e;t=s[0]}return new URL(n+e,t).toString()}var t,s=globalThis,n="./",a={},i={},o=s.parcelRequire94c2;null==o&&((o=function(e){if(e in a)return a[e].exports;if(e in i){var t=i[e];delete i[e];var s={id:e,exports:{}};return a[e]=s,t.call(s.exports,s,s.exports),s.exports}var n=Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}).register=function(e,t){i[e]=t},s.parcelRequire94c2=o),o.register,Object.assign(o.i??={},{jSdBt:"pow_bg.13eba22d.wasm",dfn7h:"pow.worker.4438c04d.js"});var r={};"use strict";r=e("jSdBt");var l={},c={};c=function(e,t,s){if(t===self.location.origin)return e;var n=s?"import "+JSON.stringify(e)+";":"importScripts("+JSON.stringify(e)+");";return URL.createObjectURL(new Blob([n],{type:"application/javascript"}))};let d=new URL(e("dfn7h"));async function m(e,t=5,s=null,n=null,a=navigator.hardwareConcurrency||1){return new Promise((i,o)=>{console.debug("fast algo");let c=[],d=()=>{c.forEach(e=>e.terminate()),null!==s&&(s.removeEventListener("abort",d),s.aborted&&(console.log("PoW aborted"),o(Error("PoW aborted"))))};null!==s&&s.addEventListener("abort",d,{once:!0}),(async()=>{var s;let m=await (await fetch((s=r)&&s.__esModule?s.default:s)).arrayBuffer();for(let s=0;s<a;s++){let r=new Worker(l);r.onmessage=e=>{"number"==typeof e.data?n?.(e.data):(d(),i(e.data))},r.onerror=e=>{d(),o(e)},r.postMessage({wasmModule:m,data:e,difficulty:t,nonce:s,threads:a}),c.push(r)}})()})}l=c(d.toString(),d.origin,!1);class u{static state={baseURL:"",version:"unknown"};static elements={title:null,mascot:null,status:null,metrics:null,message:null,progressContainer:null,progressBar:null};static initialize(e){this.state={...this.state,...e},this.elements={title:document.getElementById("title"),mascot:document.getElementById("mascot"),status:document.getElementById("status"),metrics:document.getElementById("metrics"),message:document.getElementById("message"),progressContainer:document.getElementById("progress-container"),progressBar:document.getElementById("progress-bar")}}static setState(e,t={}){switch(e){case"checking":this.setChecking(t);break;case"success":this.setSuccess(t)}}static setChecking(e){this.elements.title.textContent=e.title||"Making sure you're not a bot!",this.elements.mascot.src=`${this.state.baseURL}/static/img/mascot-puzzle.png?v=${this.state.version}`,this.elements.status.textContent=e.status||"Calculating...",this.elements.progressContainer.classList.remove("hidden"),this.setCheckingProgress(e.progress,e.metrics,e.message)}static setCheckingProgress(e,t,s){void 0!==e&&(this.elements.progressBar.style.width=`${e}%`),void 0!==t&&(""===t?this.elements.metrics.classList.add("hidden"):(this.elements.metrics.classList.remove("hidden"),this.elements.metrics.textContent=t)),void 0!==s&&(this.elements.message.textContent=s)}static setSuccess(e){this.elements.title.textContent="Success!",this.elements.mascot.src=`${this.state.baseURL}/static/img/mascot-pass.png?v=${this.state.version}`,this.elements.status.textContent=e.status||"Done!",this.elements.metrics.textContent=e.metrics||"Took ?, ? iterations",this.elements.message.textContent=e.message||"",this.elements.progressContainer.classList.add("hidden")}}(async()=>{let e=JSON.parse(document.getElementById("challenge").textContent),t=JSON.parse(document.getElementById("difficulty").textContent),s=JSON.parse(document.getElementById("baseURL").textContent),n=JSON.parse(document.getElementById("version").textContent),a=JSON.parse(document.getElementById("nonce").textContent),i=JSON.parse(document.getElementById("ts").textContent),o=JSON.parse(document.getElementById("signature").textContent);u.initialize({baseURL:s,version:n}),u.setState("checking",{metrics:`Difficulty: ${t}, Speed: calculating...`,message:""});let r=Date.now(),l=0,c=Math.pow(16,-t),d=`${e}|${a}|${i}|${o}|`,{hash:h,nonce:p}=await m(d,t,null,e=>{let s=Math.pow(1-c,e),n=(1-Math.pow(s,2))*100,a=Date.now()-r;a-l>100&&(u.setCheckingProgress(n,`Difficulty: ${t}, Speed: ${(e/a).toFixed(3)}kH/s`,s<.01?"This is taking longer than expected. Please do not refresh the page.":void 0),l=a)}),g=Date.now();console.log({hash:h,solution:p}),u.setState("success",{status:"Verification Complete!",metrics:`Took ${g-r}ms, ${p} iterations`});let f=function(e,t,s,n,a,i){let o=document.createElement("form");o.method="POST",o.action=`${s}/answer`;let r=document.createElement("input");r.type="hidden",r.name="response",r.value=e;let l=document.createElement("input");l.type="hidden",l.name="solution",l.value=t;let c=document.createElement("input");c.type="hidden",c.name="nonce",c.value=n;let d=document.createElement("input");d.type="hidden",d.name="ts",d.value=a;let m=document.createElement("input");m.type="hidden",m.name="signature",m.value=i;let u=document.createElement("input");return u.type="hidden",u.name="redir",u.value=window.location.href,o.appendChild(r),o.appendChild(l),o.appendChild(c),o.appendChild(d),o.appendChild(m),o.appendChild(u),document.body.appendChild(o),o}(h,p,s,a,i,o);setTimeout(()=>{f.submit()},250)})()})();
//# sourceMappingURL=main.js.map
